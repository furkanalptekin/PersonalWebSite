@model DB.ViewModels.CvFileModel
@{
    ViewData["Title"] = "Add";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<div class="container">
    <div class="col-12">
        <form asp-controller="CV" asp-action="Add" method="post" enctype="multipart/form-data">
            @Html.AntiForgeryToken()
            <div class="row">
                <div class="col-4">
                    <label>CV'nin Adı:</label>
                    <input asp-for="Cv.CvAdi" />
                </div>
                <div class="col-4">
                    <label>CV: </label>
                    <input type="file" asp-for="File" />
                </div>
                <div class="col-4">
                    <button class="btn btn-dark">KAYDET</button>
                </div>
            </div>
        </form>
    </div>
    <div class="col-12">
        <div class="portlet box red">
            <div class="portlet-title">
                <div class="tools">
                    <a href="javascript:;" class="collapse">
                    </a>
                    <a href="#portlet-config" data-toggle="modal" class="config">
                    </a>
                    <a href="javascript:;" class="reload">
                    </a>
                    <a href="javascript:;" class="remove">
                    </a>
                </div>
            </div>
            <div class="portlet-body">
                <div class="table-scrollable">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th> # </th>
                                <th> Cv Adı </th>
                                <th> Eklenme Tarihi </th>
                                <th> İşlemler </th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (ViewBag.List != null)
                            {
                                foreach (DB.Models.Cv cv in ViewBag.List)
                                {
                                    <tr>
                                        <td>
                                            @cv.Id
                                        </td>
                                        <td>
                                            @cv.CvAdi
                                        </td>
                                        <td>
                                            @cv.EklemeTarihi.ToString()
                                        </td>
                                        <td>
                                            <a name="@cv.Id" onclick="OpenPDF(this)" href="javascript:;">Göster</a>
                                            @*<object type="application/pdf" data="data:application/pdf;base64,@cv.B64"></object>*@
                                            <a name="@cv.Id" onclick="DeletePDF(this)" href="javascript:;">Sil</a>
                                        </td>
                                    </tr>
                                }
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>
</div>

<script>
    function OpenPDF(button) {
        $.ajax({
            url: '/CV/GetPDF/',
            type: "POST",
            dataType: "JSON",
            data: { id: button.name },
            success: function (response) {
                console.log(response);
                var objbuilder = '';
                objbuilder += ('<object width="100%" height="100%"      data="data:application/pdf;base64,');
                objbuilder += (response.b64);
                objbuilder += ('" type="application/pdf" class="internal">');
                objbuilder += ('<embed src="data:application/pdf;base64,');
                objbuilder += (response.b64);
                objbuilder += ('" type="application/pdf" />');
                objbuilder += ('</object>');

                var win = window.open("", "_blank", "titlebar=yes, left=50, top=50");
                win.document.title = response.cvName;
                win.document.write('<html><body>');
                win.document.write(objbuilder);
                win.document.write('</body></html>');
                layer = jQuery(win.document);
            }
        });
    }

    function DeletePDF(button) {
        var result = confirm("Silmek istediğinize emin misiniz?");
        if (result) {
            var $tr = $(button).closest('tr');
            $.ajax({
                url: '/CV/Delete/',
                type: "POST",
                dataType: "JSON",
                data: { id: button.name },
                success: function (response) {
                    if (response.success) {
                        $tr.find('td').fadeOut(1000, function () {
                            $tr.remove();
                        });
                    }
                }
            });
        }
    }

</script>